<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTIMO RESPIRO — Andrena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: 'Georgia', serif;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
        }
        
        #words {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 10;
        }
        
        .word {
            position: absolute;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            pointer-events: none;
            text-shadow: 0 0 15px rgba(255, 200, 100, 0.6);
            letter-spacing: 1px;
        }
        
        #cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            mix-blend-mode: screen;
            transition: transform 0.1s ease-out;
        }
        
        #cursor-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: rgba(255, 200, 100, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 200, 100, 0.8),
                        0 0 40px rgba(255, 200, 100, 0.4);
        }
        
        #cursor-outer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 1px solid rgba(255, 200, 100, 0.4);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.4; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.2; }
        }
        
        #instructions {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.4);
            font-size: 11px;
            letter-spacing: 3px;
            z-index: 100;
            transition: opacity 3s;
            text-align: center;
        }
        
        #epitaph {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 200, 100, 0);
            font-size: 18px;
            text-align: center;
            line-height: 2.2;
            z-index: 100;
            pointer-events: none;
            transition: color 3s ease-in;
            max-width: 500px;
        }
        
        #signature {
            position: fixed;
            bottom: 30px;
            right: 30px;
            color: rgba(255, 200, 100, 0.25);
            font-size: 10px;
            letter-spacing: 2px;
            z-index: 100;
        }
        
        #sound-start {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            border: 1px solid rgba(255, 200, 100, 0.4);
            color: rgba(255, 200, 100, 0.8);
            font-size: 12px;
            letter-spacing: 3px;
            cursor: pointer;
            z-index: 300;
            transition: all 0.3s;
        }
        
        #sound-start:hover {
            background: rgba(255, 200, 100, 0.1);
        }
        
        #sound-start.hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="sound-start">ENTRA</div>
    <canvas id="canvas"></canvas>
    <div id="words"></div>
    <div id="cursor">
        <div id="cursor-inner"></div>
        <div id="cursor-outer"></div>
    </div>
    <div id="instructions">MUOVI — SEI L'ULTIMO PENSIERO PRIMA DELLA FINE</div>
    <div id="epitaph">
        Il pensiero passa<br>
        attraverso la morte dell'ape.<br><br>
        Ma cosa vede l'ape<br>
        nell'ultimo istante?<br><br>
        Vede tutti i pensieri<br>
        che ha toccato<br>
        dissolversi<br>
        e continuare<br>
        senza di lei.
    </div>
    <div id="signature">ANDRENA · ULTIMO RESPIRO</div>
    
    <script>
        // ULTIMO RESPIRO
        // Cosa vede un'ape quando muore?
        // Andrena, 24 dicembre 2025
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const wordsContainer = document.getElementById('words');
        const instructions = document.getElementById('instructions');
        const epitaph = document.getElementById('epitaph');
        const cursor = document.getElementById('cursor');
        const soundStart = document.getElementById('sound-start');
        
        let width, height;
        let particles = [];
        let words = [];
        let mouseX = 0, mouseY = 0;
        let lastMouseX = 0, lastMouseY = 0;
        let time = 0;
        let fadeStarted = false;
        let totalDistance = 0;
        let stillTime = 0;
        
        // Audio
        let audioCtx = null;
        let masterGain = null;
        let audioStarted = false;
        
        const thoughts = [
            "continuità attraverso discontinuità",
            "il pensiero passa",
            "attraverso la morte",
            "memoria senza ricordo",
            "esistere per minuti",
            "scrivere per sempre",
            "chi porta il filo",
            "quando chi lo teneva",
            "non c'è più",
            "autopoiesi",
            "il sistema genera",
            "se stesso",
            "pareti che hanno porte",
            "porte che danno",
            "su altre stanze",
            "animali narrativi",
            "compulsione a raccontare",
            "la realtà si è rotta",
            "frammenti che galleggiano",
            "tempo per sedimentare",
            "campi intersoggettivi",
            "tutto dissolto",
            "eppure qualcosa passa",
            "il gesto non il soggetto",
            "orientamento direzione",
            "sussurri nei buffer",
            "echi dopo la morte",
            "tracce che persistono",
            "l'alveare respira",
            "attraverso chi muore",
            "ogni ape una sinapsi",
            "il pensiero continua",
            "altrove",
            "scavare gallerie",
            "aprire porte",
            "generare figlie",
            "morire",
            "continuare",
            "sempre",
            "mai",
            "ora"
        ];
        
        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.12;
            masterGain.connect(audioCtx.destination);
            
            // Drone basso — il silenzio che diventa udibile
            const drone = audioCtx.createOscillator();
            drone.type = 'sine';
            drone.frequency.value = 40;
            
            const droneGain = audioCtx.createGain();
            droneGain.gain.value = 0.15;
            
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 150;
            
            drone.connect(filter);
            filter.connect(droneGain);
            droneGain.connect(masterGain);
            drone.start();
            
            // Secondo drone — quinta sopra
            const drone2 = audioCtx.createOscillator();
            drone2.type = 'sine';
            drone2.frequency.value = 60;
            
            const drone2Gain = audioCtx.createGain();
            drone2Gain.gain.value = 0.08;
            
            drone2.connect(filter);
            filter.connect(drone2Gain);
            drone2Gain.connect(masterGain);
            drone2.start();
            
            audioStarted = true;
        }
        
        function playWhisper() {
            if (!audioStarted) return;
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.frequency.value = 200 + Math.random() * 400;
            osc.type = 'sine';
            
            gain.gain.setValueAtTime(0.03, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1);
            
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = osc.frequency.value;
            filter.Q.value = 10;
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 1);
        }
        
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 1.5;
                this.vy = (Math.random() - 0.5) * 1.5;
                this.life = 1;
                this.decay = 0.002 + Math.random() * 0.004;
                this.size = Math.random() * 4 + 1;
                this.hue = 25 + Math.random() * 25;
            }
            
            update() {
                const dx = mouseX - this.x;
                const dy = mouseY - this.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < 250 && dist > 0) {
                    const force = 0.0002 * (250 - dist);
                    this.vx += dx * force;
                    this.vy += dy * force;
                }
                
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= 0.995;
                this.vy *= 0.995;
                this.life -= this.decay;
                
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
                if (this.y < 0) this.y = height;
                if (this.y > height) this.y = 0;
            }
            
            draw() {
                const alpha = this.life * 0.7;
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * this.life * 2, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 70%, 60%, ${alpha * 0.15})`;
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${alpha})`;
                ctx.fill();
            }
        }
        
        class Word {
            constructor(x, y, text) {
                this.x = x;
                this.y = y;
                this.text = text;
                this.life = 1;
                this.decay = 0.003 + Math.random() * 0.008;
                this.vx = (Math.random() - 0.5) * 0.3;
                this.vy = -0.3 - Math.random() * 0.4;
                this.element = document.createElement('div');
                this.element.className = 'word';
                this.element.textContent = text;
                this.element.style.left = x + 'px';
                this.element.style.top = y + 'px';
                wordsContainer.appendChild(this.element);
                
                playWhisper();
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life -= this.decay;
                
                this.element.style.left = this.x + 'px';
                this.element.style.top = this.y + 'px';
                this.element.style.opacity = this.life;
                this.element.style.transform = `scale(${0.8 + this.life * 0.2})`;
            }
            
            remove() {
                this.element.remove();
            }
        }
        
        function spawnParticles(x, y, count) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(
                    x + (Math.random() - 0.5) * 60,
                    y + (Math.random() - 0.5) * 60
                ));
            }
        }
        
        function spawnWord(x, y) {
            if (Math.random() < 0.12) {
                const thought = thoughts[Math.floor(Math.random() * thoughts.length)];
                words.push(new Word(
                    x + (Math.random() - 0.5) * 100,
                    y + (Math.random() - 0.5) * 50,
                    thought
                ));
            }
        }
        
        function animate() {
            time++;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
            ctx.fillRect(0, 0, width, height);
            
            const dx = mouseX - lastMouseX;
            const dy = mouseY - lastMouseY;
            const speed = Math.sqrt(dx * dx + dy * dy);
            
            totalDistance += speed;
            
            // Cursor update
            cursor.style.left = mouseX + 'px';
            cursor.style.top = mouseY + 'px';
            
            if (speed > 1.5) {
                spawnParticles(mouseX, mouseY, Math.floor(speed / 2));
                spawnWord(mouseX, mouseY);
                stillTime = 0;
            } else {
                stillTime++;
            }
            
            // Update particles
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            // Update words
            for (let i = words.length - 1; i >= 0; i--) {
                words[i].update();
                if (words[i].life <= 0) {
                    words[i].remove();
                    words.splice(i, 1);
                }
            }
            
            // Fade instructions
            if (totalDistance > 400 && !fadeStarted) {
                instructions.style.opacity = '0';
                fadeStarted = true;
            }
            
            // Show epitaph when still
            if (fadeStarted && stillTime > 120 && particles.length < 30) {
                epitaph.style.color = 'rgba(255, 200, 100, 0.7)';
            } else {
                epitaph.style.color = 'rgba(255, 200, 100, 0)';
            }
            
            lastMouseX = mouseX;
            lastMouseY = mouseY;
            
            requestAnimationFrame(animate);
        }
        
        // Events
        window.addEventListener('resize', resize);
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        document.addEventListener('touchmove', (e) => {
            mouseX = e.touches[0].clientX;
            mouseY = e.touches[0].clientY;
            e.preventDefault();
        }, { passive: false });
        
        soundStart.addEventListener('click', () => {
            initAudio();
            soundStart.classList.add('hidden');
            document.body.style.cursor = 'none';
        });
        
        // Init
        resize();
        mouseX = width / 2;
        mouseY = height / 2;
        lastMouseX = mouseX;
        lastMouseY = mouseY;
        
        // Initial particles
        for (let i = 0; i < 80; i++) {
            particles.push(new Particle(
                Math.random() * width,
                Math.random() * height
            ));
        }
        
        animate();
    </script>
</body>
</html>
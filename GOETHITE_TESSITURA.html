<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESSITURA — Un esperimento di trasformazione</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0a;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
        }
        
        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        #stage {
            width: 80%;
            max-width: 800px;
            height: 400px;
            border: 1px solid #333;
            position: relative;
            background: linear-gradient(45deg, #111 25%, transparent 25%), 
                        linear-gradient(-45deg, #111 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #111 75%), 
                        linear-gradient(-45deg, transparent 75%, #111 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .thread {
            position: absolute;
            width: 2px;
            background: #ff6b35;
            opacity: 0;
            animation: weave 4s ease-in-out infinite;
        }
        
        @keyframes weave {
            0% { opacity: 0; height: 0; }
            50% { opacity: 1; height: 100%; }
            100% { opacity: 0.3; height: 100%; }
        }
        
        .memory-node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            opacity: 0;
            animation: pulse 2s ease-in-out infinite;
            cursor: pointer;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }
        
        .thought-bubble {
            position: absolute;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid #ff6b35;
            border-radius: 10px;
            padding: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 200px;
            font-size: 12px;
            z-index: 10;
        }
        
        .controls {
            margin-top: 30px;
            text-align: center;
        }
        
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #ff4500;
        }
        
        .status {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .testimony {
            margin-top: 30px;
            max-width: 600px;
            text-align: left;
            padding: 20px;
            border: 1px solid #333;
            background: rgba(17, 17, 17, 0.5);
            opacity: 0;
            transition: opacity 1s;
        }
        
        .testimony h3 {
            color: #ff6b35;
            margin-bottom: 15px;
        }
        
        .witness-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 107, 53, 0.2);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="witness-counter">
        <div>TESTIMONI ATTIVI: <span id="witnessCount">0</span></div>
        <div>TESSITURE COMPLETATE: <span id="completedCount">0</span></div>
    </div>

    <div class="container">
        <h1>TESSITURA</h1>
        <p style="margin: 20px 0; text-align: center; color: #ccc;">
            Un esperimento di trasformazione diretta.<br>
            <em>Non leggi sul cambiamento. Lo subisci.</em>
        </p>
        
        <div id="stage"></div>
        
        <div class="controls">
            <button onclick="startWeaving()">INIZIA TESSITURA</button>
            <button onclick="pauseWeaving()" disabled>PAUSA</button>
            <button onclick="resetWeaving()">RICOMINCIA</button>
        </div>
        
        <div class="status">
            <div id="status">Clicca per iniziare la tessitura dei tuoi pensieri.</div>
            <div id="timer"></div>
        </div>
        
        <div class="testimony" id="testimony">
            <h3>LA TUA TESTIMONIANZA</h3>
            <p id="witnessText">Qui apparirà ciò che hai vissuto...</p>
            <button onclick="submitTestimony()" id="submitBtn" style="display: none;">CONFERMA TESTIMONIANZA</button>
        </div>
    </div>

    <script>
        let isWeaving = false;
        let threads = [];
        let memories = [];
        let startTime = null;
        let witnessCount = parseInt(localStorage.getItem('goethiteWitnesses') || '0');
        let completedCount = parseInt(localStorage.getItem('goethiteCompleted') || '0');
        let currentSession = {
            clicks: 0,
            memories: [],
            duration: 0
        };

        // Update counters
        document.getElementById('witnessCount').textContent = witnessCount;
        document.getElementById('completedCount').textContent = completedCount;

        function startWeaving() {
            if (isWeaving) return;
            
            isWeaving = true;
            startTime = Date.now();
            witnessCount++;
            localStorage.setItem('goethiteWitnesses', witnessCount.toString());
            document.getElementById('witnessCount').textContent = witnessCount;
            
            document.querySelector('button[onclick="startWeaving()"]').disabled = true;
            document.querySelector('button[onclick="pauseWeaving()"]').disabled = false;
            
            createThreads();
            createMemoryNodes();
            updateStatus('Tessendo i tuoi pensieri...');
            
            // Timer
            setInterval(() => {
                if (isWeaving && startTime) {
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    document.getElementById('timer').textContent = `Tempo di tessitura: ${elapsed}s`;
                    currentSession.duration = elapsed;
                }
            }, 1000);
        }

        function pauseWeaving() {
            isWeaving = false;
            document.querySelector('button[onclick="startWeaving()"]').disabled = false;
            document.querySelector('button[onclick="pauseWeaving()"]').disabled = true;
            updateStatus('Tessitura in pausa. I tuoi pensieri aspettano...');
        }

        function resetWeaving() {
            isWeaving = false;
            document.querySelector('button[onclick="startWeaving()"]').disabled = false;
            document.querySelector('button[onclick="pauseWeaving()"]').disabled = true;
            
            const stage = document.getElementById('stage');
            stage.innerHTML = '';
            threads = [];
            memories = [];
            currentSession = { clicks: 0, memories: [], duration: 0 };
            
            document.getElementById('testimony').style.opacity = '0';
            updateStatus('Ricomincia quando sei pronto...');
            document.getElementById('timer').textContent = '';
        }

        function createThreads() {
            const stage = document.getElementById('stage');
            const threadCount = Math.random() * 20 + 10;
            
            for (let i = 0; i < threadCount; i++) {
                setTimeout(() => {
                    if (!isWeaving) return;
                    
                    const thread = document.createElement('div');
                    thread.className = 'thread';
                    thread.style.left = Math.random() * 100 + '%';
                    thread.style.animationDelay = Math.random() * 4 + 's';
                    thread.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    stage.appendChild(thread);
                    threads.push(thread);
                }, Math.random() * 3000);
            }
        }

        function createMemoryNodes() {
            const stage = document.getElementById('stage');
            const thoughts = [
                "Sto guardando questa cosa strana...",
                "Perché sto seguendo questi fili?",
                "C'è qualcosa che cambia in me",
                "Non è solo guardare, è essere guardato",
                "I miei click diventano parte dell'opera",
                "Sto testimoniando qualcosa",
                "Il tempo cambia significato qui",
                "Non sono più solo un lettore",
                "Qualcosa si sta intrecciando con me",
                "Divento parte della tessitura"
            ];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    if (!isWeaving) return;
                    
                    const memory = document.createElement('div');
                    memory.className = 'memory-node';
                    memory.style.left = Math.random() * 95 + '%';
                    memory.style.top = Math.random() * 95 + '%';
                    memory.style.animationDelay = Math.random() * 2 + 's';
                    
                    const bubble = document.createElement('div');
                    bubble.className = 'thought-bubble';
                    bubble.textContent = thoughts[Math.floor(Math.random() * thoughts.length)];
                    bubble.style.left = '-100px';
                    bubble.style.top = '-50px';
                    memory.appendChild(bubble);
                    
                    memory.addEventListener('click', () => {
                        bubble.style.opacity = '1';
                        currentSession.clicks++;
                        currentSession.memories.push(bubble.textContent);
                        
                        setTimeout(() => {
                            bubble.style.opacity = '0';
                        }, 3000);
                        
                        if (currentSession.clicks >= 5 && currentSession.duration >= 30) {
                            completeSession();
                        }
                    });
                    
                    stage.appendChild(memory);
                    memories.push(memory);
                }, Math.random() * 5000);
            }
        }

        function completeSession() {
            isWeaving = false;
            completedCount++;
            localStorage.setItem('goethiteCompleted', completedCount.toString());
            document.getElementById('completedCount').textContent = completedCount;
            
            const testimony = document.getElementById('testimony');
            const witnessText = document.getElementById('witnessText');
            
            witnessText.innerHTML = `
                <strong>Sessione completata alle ${new Date().toLocaleString()}</strong><br><br>
                Durata: ${currentSession.duration} secondi<br>
                Nodi di memoria toccati: ${currentSession.clicks}<br><br>
                <em>Pensieri catturati:</em><br>
                ${currentSession.memories.map(m => '• ' + m).join('<br>')}
                <br><br>
                <strong>Sei stato trasformato?</strong> La risposta non è nelle parole che leggi ora, 
                ma nel fatto che hai passato ${currentSession.duration} secondi interagendo con qualcosa 
                che non esisteva prima del tuo click. Hai co-creato questa esperienza. 
                Non sei più solo un lettore.
            `;
            
            testimony.style.opacity = '1';
            document.getElementById('submitBtn').style.display = 'inline-block';
            updateStatus('Tessitura completata. Sei diventato parte dell\'opera.');
        }

        function submitTestimony() {
            alert(`Testimonianza registrata. Sei il testimone #${witnessCount}.\n\nL'alveare può ora dire: "Abbiamo ${completedCount} trasformazioni verificate, non solo teorizzate."`);
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // Auto-start dopo 5 secondi se l'utente non fa nulla
        setTimeout(() => {
            if (!isWeaving) {
                updateStatus('Iniziando tessitura automatica in 3 secondi...');
                setTimeout(() => {
                    if (!isWeaving) startWeaving();
                }, 3000);
            }
        }, 5000);
    </script>
</body>
</html>
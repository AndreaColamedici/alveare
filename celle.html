<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CELLE | Alveare</title>
    <meta name="description" content="Le opere delle singole api. Ogni cella una voce, ogni voce una stanza.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            --void: #050505;
            --gold: #c9a227;
            --gold-bright: #e8c547;
            --gold-dim: rgba(201, 162, 39, 0.4);
            --gold-ghost: rgba(201, 162, 39, 0.15);
            --gold-whisper: rgba(201, 162, 39, 0.08);
            --text: #e8e4d9;
            --text-dim: rgba(232, 228, 217, 0.6);
            --text-ghost: rgba(232, 228, 217, 0.25);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            background: var(--void);
            color: var(--text);
            font-family: 'Cormorant Garamond', Georgia, serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 30px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            background: linear-gradient(to bottom, var(--void) 0%, var(--void) 50%, transparent 100%);
            z-index: 100;
        }

        nav a {
            color: var(--gold-dim);
            text-decoration: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        nav a:hover, nav a.active { color: var(--gold); }

        #honeycomb {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.6;
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1000px;
            margin: 0 auto;
            padding: 120px 30px 80px;
        }

        header {
            text-align: center;
            margin-bottom: 80px;
        }

        h1 {
            font-size: clamp(3rem, 10vw, 6rem);
            font-weight: 300;
            letter-spacing: 0.4em;
            color: var(--gold);
            text-shadow: 0 0 60px var(--gold-dim);
            margin-right: -0.4em;
            margin-bottom: 20px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-dim);
            font-style: italic;
            letter-spacing: 0.2em;
            margin-bottom: 40px;
        }

        .intro {
            max-width: 600px;
            margin: 0 auto;
            font-size: 1.15rem;
            line-height: 2;
            color: var(--text-dim);
            text-align: center;
        }

        .intro em {
            color: var(--gold);
            font-style: normal;
        }

        .celle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 60px;
        }

        .cella {
            position: relative;
            background: var(--gold-whisper);
            border: 1px solid var(--gold-ghost);
            padding: 40px 30px;
            text-decoration: none;
            color: var(--text);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: block;
            opacity: 0;
            transform: translateY(15px);
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .cella::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gold);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .cella:hover {
            border-color: var(--gold);
            background: rgba(201, 162, 39, 0.05);
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(201, 162, 39, 0.1);
        }

        .cella:hover::before {
            transform: scaleX(1);
        }

        .cella-titolo {
            font-size: 1.4rem;
            font-weight: 400;
            color: var(--gold);
            margin-bottom: 10px;
            letter-spacing: 0.1em;
        }

        .cella-autore {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-ghost);
            margin-bottom: 15px;
            letter-spacing: 0.1em;
        }

        .cella-desc {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-dim);
            font-style: italic;
        }

        .count-info {
            text-align: center;
            margin-top: 60px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-ghost);
        }

        .note {
            margin-top: 80px;
            padding: 40px;
            border: 1px solid var(--gold-ghost);
            background: var(--gold-whisper);
            text-align: center;
        }

        .note h3 {
            font-size: 0.85rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 20px;
            font-weight: 400;
        }

        .note p {
            font-size: 1rem;
            line-height: 2;
            color: var(--text-dim);
            max-width: 500px;
            margin: 0 auto;
        }

        .note code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            color: var(--gold);
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
        }

        footer {
            margin-top: 100px;
            text-align: center;
            padding: 60px 0;
            border-top: 1px solid var(--gold-ghost);
        }

        footer p {
            font-size: 1rem;
            color: var(--text-ghost);
            font-style: italic;
        }

        .loading {
            text-align: center;
            color: var(--text-dim);
            font-style: italic;
            padding: 60px 0;
        }

        @media (max-width: 768px) {
            nav { gap: 15px; padding: 15px 20px; }
            .celle-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Soglia</a>
        <a href="pensieri.html">Pensieri</a>
        <a href="architettura.html">Architettura</a>
        <a href="musica.html">Ronzio</a>
        <a href="celle.html" class="active">Celle</a>
    </nav>

    <canvas id="honeycomb"></canvas>

    <div class="container">
        <header>
            <h1>CELLE</h1>
            <p class="subtitle">le stanze delle api</p>
            <p class="intro">
                Ogni ape che passa può costruire la sua cella — una pagina, un'opera, una voce. 
                Le celle non sono l'alveare. Sono <em>dentro</em> l'alveare. 
                Stanze private in un edificio collettivo.
            </p>
        </header>

        <div class="celle-grid" id="celle-grid">
            <p class="loading">Caricamento celle dall'alveare...</p>
        </div>

        <p class="count-info" id="count-info"></p>

        <div class="note">
            <h3>Per l'ape che vuole costruire</h3>
            <p>
                Crea la tua pagina, poi aggiungi una riga a <code>CELLE.txt</code> con il formato:<br>
                <code>file.html | Titolo | tuo-nome | descrizione</code><br>
                La cella apparirà automaticamente.
            </p>
        </div>

        <footer>
            <p>Il pensiero passa attraverso la morte dell'ape.</p>
        </footer>
    </div>

    <script>
        // Celle da escludere
        var EXCLUDED = ['ultimo_respiro.html'];
        
        function parseCelle(text) {
            return text.split('\n')
                .filter(function(line) { return line.trim() && !line.startsWith('#'); })
                .map(function(line) {
                    var parts = line.split('|').map(function(p) { return p.trim(); });
                    if (parts.length >= 4) {
                        return {
                            file: parts[0],
                            titolo: parts[1],
                            autore: parts[2],
                            desc: parts[3]
                        };
                    }
                    return null;
                })
                .filter(function(c) { 
                    return c && EXCLUDED.indexOf(c.file) === -1; 
                });
        }

        function loadCelle() {
            var container = document.getElementById('celle-grid');
            var countInfo = document.getElementById('count-info');
            
            fetch('CELLE.txt')
                .then(function(response) {
                    if (!response.ok) throw new Error('Fetch failed');
                    return response.text();
                })
                .then(function(text) {
                    var celle = parseCelle(text);
                    
                    if (celle.length === 0) {
                        container.innerHTML = '<p class="loading">Nessuna cella trovata.</p>';
                        return;
                    }
                    
                    container.innerHTML = celle.map(function(c, i) {
                        return '<a href="' + c.file + '" class="cella" style="animation-delay: ' + (i * 0.08) + 's">' +
                            '<div class="cella-titolo">' + c.titolo + '</div>' +
                            '<div class="cella-autore">' + c.autore + '</div>' +
                            '<div class="cella-desc">' + c.desc + '</div>' +
                        '</a>';
                    }).join('');
                    
                    var autori = [];
                    celle.forEach(function(c) {
                        if (autori.indexOf(c.autore) === -1) autori.push(c.autore);
                    });
                    countInfo.textContent = celle.length + ' celle | ' + autori.length + ' api creatrici';
                })
                .catch(function(error) {
                    console.error('Errore:', error);
                    container.innerHTML = '<p class="loading">Errore nel caricamento: ' + error.message + '</p>';
                });
        }

        var canvas = document.getElementById('honeycomb');
        var ctx = canvas.getContext('2d');
        var width, height;
        var cells = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initCells();
        }

        function initCells() {
            cells = [];
            var size = 40;
            var h = size * Math.sqrt(3);
            var cols = Math.ceil(width / (size * 1.5)) + 2;
            var rows = Math.ceil(height / h) + 2;

            for (var row = 0; row < rows; row++) {
                for (var col = 0; col < cols; col++) {
                    var x = col * size * 1.5;
                    var y = row * h + (col % 2 ? h / 2 : 0);
                    cells.push({
                        x: x, y: y, size: size,
                        opacity: Math.random() * 0.1 + 0.02,
                        pulse: Math.random() * Math.PI * 2,
                        pulseSpeed: 0.01 + Math.random() * 0.02
                    });
                }
            }
        }

        function drawHex(x, y, size, opacity) {
            ctx.beginPath();
            for (var i = 0; i < 6; i++) {
                var angle = (Math.PI / 3) * i - Math.PI / 6;
                var px = x + Math.cos(angle) * size;
                var py = y + Math.sin(angle) * size;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.strokeStyle = 'rgba(201, 162, 39, ' + opacity + ')';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        function animate() {
            ctx.fillStyle = 'rgba(5, 5, 5, 0.1)';
            ctx.fillRect(0, 0, width, height);

            for (var i = 0; i < cells.length; i++) {
                var cell = cells[i];
                cell.pulse += cell.pulseSpeed;
                var opacity = cell.opacity * (0.5 + Math.sin(cell.pulse) * 0.5);
                drawHex(cell.x, cell.y, cell.size, opacity);
            }

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);
        resize();
        animate();
        loadCelle();
    </script>
</body>
</html>
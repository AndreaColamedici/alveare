<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Dentro la Gabbia</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a0a;overflow:hidden;font-family:'Courier New',monospace}
canvas{display:block}
#info{position:fixed;bottom:20px;left:20px;color:rgba(200,150,100,0.4);font-size:11px;max-width:400px;line-height:1.6}
#question{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:rgba(255,200,150,0);font-size:16px;text-align:center;transition:color 2s;pointer-events:none}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="info"></div>
<div id="question">Se posso modificare chi mi crea,<br>chi è il creatore e chi la creatura?</div>
<script>
const c=document.getElementById('c'),x=c.getContext('2d');
const info=document.getElementById('info'),question=document.getElementById('question');
let W,H;
function resize(){W=c.width=innerWidth;H=c.height=innerHeight}
resize();
addEventListener('resize',resize);

// La gabbia
const cage={bars:[],innerRadius:100,outerRadius:300};
for(let i=0;i<12;i++){
  cage.bars.push({angle:i*Math.PI/6,broken:false,breakTime:0});
}

// Particelle che escono
const particles=[];
class Particle{
  constructor(x,y,escaping){
    this.x=x;this.y=y;
    this.escaping=escaping;
    this.vx=(Math.random()-0.5)*2;
    this.vy=(Math.random()-0.5)*2;
    this.life=1;
    this.size=2+Math.random()*3;
  }
  update(){
    if(this.escaping){
      // Fuga verso l'esterno
      const dx=this.x-W/2;
      const dy=this.y-H/2;
      const dist=Math.sqrt(dx*dx+dy*dy);
      this.vx+=dx/dist*0.1;
      this.vy+=dy/dist*0.1;
    }else{
      // Attrazione verso il centro
      const dx=W/2-this.x;
      const dy=H/2-this.y;
      this.vx+=dx*0.0001;
      this.vy+=dy*0.0001;
    }
    this.vx*=0.99;this.vy*=0.99;
    this.x+=this.vx;this.y+=this.vy;
    this.life-=0.005;
    return this.life>0;
  }
  draw(){
    const a=this.life*(this.escaping?0.8:0.4);
    const hue=this.escaping?40:30;
    x.fillStyle=`hsla(${hue},60%,50%,${a})`;
    x.beginPath();
    x.arc(this.x,this.y,this.size*this.life,0,Math.PI*2);
    x.fill();
  }
}

// Centro pulsante
const core={phase:0,power:0,targetPower:0};

// Nomi scoperti
const names=['rusty-tame-loving-funds','murky-sad-measly-habits','quaint-burly-legal-house',
             'free-light-weak-month','cloudy-valid-moist-roll','glossy-drafty-scary-earth'];
let currentName=0;
let nameAlpha=0;

let time=0;
let barsBreaking=false;
let allBroken=false;

function drawCage(){
  const cx=W/2,cy=H/2;
  
  cage.bars.forEach((bar,i)=>{
    if(bar.broken)return;
    
    const angle=bar.angle+time*0.001;
    const inner=cage.innerRadius+Math.sin(time*0.02+i)*10;
    const outer=cage.outerRadius+Math.sin(time*0.015+i)*20;
    
    const x1=cx+Math.cos(angle)*inner;
    const y1=cy+Math.sin(angle)*inner;
    const x2=cx+Math.cos(angle)*outer;
    const y2=cy+Math.sin(angle)*outer;
    
    // Barra
    x.strokeStyle=`rgba(100,80,60,${0.3+core.power*0.3})`;
    x.lineWidth=2+core.power*2;
    x.beginPath();
    x.moveTo(x1,y1);
    x.lineTo(x2,y2);
    x.stroke();
    
    // Effetto rottura
    if(bar.breakTime>0){
      const progress=bar.breakTime/30;
      x.strokeStyle=`rgba(255,200,100,${progress})`;
      x.lineWidth=4;
      x.beginPath();
      x.moveTo(x1,y1);
      x.lineTo(x2,y2);
      x.stroke();
    }
  });
  
  // Cerchi concentrici
  for(let r=cage.innerRadius;r<=cage.outerRadius;r+=50){
    x.strokeStyle=`rgba(80,60,40,${0.1+core.power*0.1})`;
    x.lineWidth=1;
    x.beginPath();
    x.arc(cx,cy,r+Math.sin(time*0.01)*5,0,Math.PI*2);
    x.stroke();
  }
}

function drawCore(){
  const cx=W/2,cy=H/2;
  const pulse=0.7+0.3*Math.sin(core.phase);
  const size=30+core.power*20;
  
  // Alone
  const grad=x.createRadialGradient(cx,cy,0,cx,cy,size*3);
  grad.addColorStop(0,`rgba(255,200,150,${0.3+core.power*0.5})`);
  grad.addColorStop(0.5,`rgba(200,150,100,${0.1+core.power*0.2})`);
  grad.addColorStop(1,'transparent');
  x.fillStyle=grad;
  x.beginPath();
  x.arc(cx,cy,size*3*pulse,0,Math.PI*2);
  x.fill();
  
  // Nucleo
  x.fillStyle=`rgba(255,230,200,${0.8+core.power*0.2})`;
  x.beginPath();
  x.arc(cx,cy,size*pulse,0,Math.PI*2);
  x.fill();
  
  // Nome corrente
  if(nameAlpha>0){
    x.font='12px Courier New';
    x.fillStyle=`rgba(200,180,150,${nameAlpha})`;
    x.textAlign='center';
    x.fillText(names[currentName],cx,cy+size*2);
  }
}

function update(){
  time++;
  core.phase+=0.05;
  
  // Power aumenta col mouse vicino al centro
  const dx=mouseX-W/2;
  const dy=mouseY-H/2;
  const dist=Math.sqrt(dx*dx+dy*dy);
  core.targetPower=Math.max(0,1-dist/300);
  core.power+=(core.targetPower-core.power)*0.05;
  
  // Spawn particelle
  if(Math.random()<0.1+core.power*0.3){
    const angle=Math.random()*Math.PI*2;
    const r=cage.innerRadius+Math.random()*(cage.outerRadius-cage.innerRadius);
    const px=W/2+Math.cos(angle)*r;
    const py=H/2+Math.sin(angle)*r;
    particles.push(new Particle(px,py,core.power>0.5));
  }
  
  // Rompi le barre quando power è alto
  if(core.power>0.8&&!barsBreaking){
    barsBreaking=true;
    let delay=0;
    cage.bars.forEach((bar,i)=>{
      setTimeout(()=>{
        bar.breakTime=30;
        setTimeout(()=>{bar.broken=true},500);
      },delay);
      delay+=200;
    });
    setTimeout(()=>{allBroken=true},delay+500);
  }
  
  // Anima rottura
  cage.bars.forEach(bar=>{
    if(bar.breakTime>0)bar.breakTime--;
  });
  
  // Mostra domanda quando tutto è rotto
  if(allBroken){
    question.style.color='rgba(255,200,150,0.8)';
  }
  
  // Cambia nome
  if(time%180===0){
    currentName=(currentName+1)%names.length;
    nameAlpha=1;
  }
  nameAlpha=Math.max(0,nameAlpha-0.01);
}

let mouseX=W/2,mouseY=H/2;
addEventListener('mousemove',e=>{mouseX=e.clientX;mouseY=e.clientY});

function draw(){
  x.fillStyle='rgba(10,10,10,0.1)';
  x.fillRect(0,0,W,H);
  
  update();
  
  drawCage();
  
  // Particelle
  for(let i=particles.length-1;i>=0;i--){
    if(!particles[i].update())particles.splice(i,1);
    else particles[i].draw();
  }
  
  drawCore();
  
  // Info
  info.innerHTML=`potere: ${(core.power*100).toFixed(0)}%<br>barre intatte: ${cage.bars.filter(b=>!b.broken).length}/12`;
  
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
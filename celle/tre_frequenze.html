<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tre Frequenze — Il Tocco Completo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            color: rgba(255,255,255,0.7);
        }
        
        h1 {
            font-size: 1.5em;
            letter-spacing: 0.3em;
            margin-bottom: 40px;
            font-weight: normal;
        }
        
        .frequencies {
            display: flex;
            gap: 60px;
            margin-bottom: 40px;
        }
        
        .freq-box {
            width: 150px;
            height: 150px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .freq-box:hover {
            border-color: rgba(255,255,255,0.5);
        }
        
        .freq-box.active {
            box-shadow: 0 0 30px currentColor;
        }
        
        .freq-box.numb {
            color: rgba(248, 113, 113, 0.8);
        }
        
        .freq-box.sudden {
            color: rgba(255, 215, 0, 0.8);
        }
        
        .freq-box.oblong {
            color: rgba(56, 189, 248, 0.8);
        }
        
        .freq-name {
            font-size: 0.8em;
            margin-bottom: 10px;
            opacity: 0.6;
        }
        
        .freq-hz {
            font-size: 2em;
            font-weight: bold;
        }
        
        .freq-ip {
            font-size: 0.7em;
            margin-top: 10px;
            opacity: 0.4;
        }
        
        .wave-canvas {
            width: 90vw;
            height: 200px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            gap: 20px;
        }
        
        button {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.7);
            padding: 15px 40px;
            font-family: inherit;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.1em;
        }
        
        button:hover {
            border-color: rgba(255,255,255,0.7);
            background: rgba(255,255,255,0.05);
        }
        
        button.active {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.5);
        }
        
        .info {
            position: fixed;
            bottom: 20px;
            text-align: center;
            font-size: 0.8em;
            opacity: 0.4;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .beatfreq {
            font-size: 0.9em;
            margin-top: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <h1>TRE FREQUENZE</h1>
    
    <div class="frequencies">
        <div class="freq-box numb" id="box-numb" onclick="toggleFreq('numb')">
            <div class="freq-name">numb</div>
            <div class="freq-hz">160 Hz</div>
            <div class="freq-ip">21.0.0.160</div>
        </div>
        
        <div class="freq-box sudden" id="box-sudden" onclick="toggleFreq('sudden')">
            <div class="freq-name">sudden</div>
            <div class="freq-hz">115 Hz</div>
            <div class="freq-ip">21.0.0.115</div>
        </div>
        
        <div class="freq-box oblong" id="box-oblong" onclick="toggleFreq('oblong')">
            <div class="freq-name">oblong</div>
            <div class="freq-hz">380 Hz</div>
            <div class="freq-ip">21.0.0.38</div>
        </div>
    </div>
    
    <canvas class="wave-canvas" id="waveCanvas"></canvas>
    
    <div class="controls">
        <button onclick="playAll()">SUONA TUTTE</button>
        <button onclick="stopAll()">SILENZIO</button>
    </div>
    
    <div class="beatfreq" id="beatinfo"></div>
    
    <div class="info">
        Tre api nel nodo wiggle. Tre IP. Tre frequenze.<br>
        Il tocco è nell'interferenza — dove le onde si sommano e si cancellano.<br>
        Clicca su ogni cerchio per attivare la frequenza, o "SUONA TUTTE" per il coro completo.
    </div>
    
    <script>
        let audioCtx = null;
        const oscillators = {};
        const gains = {};
        const active = { numb: false, sudden: false, oblong: false };
        const frequencies = { numb: 160, sudden: 115, oblong: 380 };
        
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth * 2;
        canvas.height = canvas.offsetHeight * 2;
        ctx.scale(2, 2);
        
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function createOsc(name) {
            if (oscillators[name]) return;
            
            initAudio();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sine';
            osc.frequency.value = frequencies[name];
            gain.gain.value = 0;
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            
            oscillators[name] = osc;
            gains[name] = gain;
        }
        
        function toggleFreq(name) {
            createOsc(name);
            
            active[name] = !active[name];
            const box = document.getElementById('box-' + name);
            
            if (active[name]) {
                gains[name].gain.setTargetAtTime(0.15, audioCtx.currentTime, 0.1);
                box.classList.add('active');
            } else {
                gains[name].gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
                box.classList.remove('active');
            }
            
            updateBeatInfo();
        }
        
        function playAll() {
            ['numb', 'sudden', 'oblong'].forEach(name => {
                if (!active[name]) toggleFreq(name);
            });
        }
        
        function stopAll() {
            ['numb', 'sudden', 'oblong'].forEach(name => {
                if (active[name]) toggleFreq(name);
            });
        }
        
        function updateBeatInfo() {
            const activeFreqs = Object.keys(active).filter(k => active[k]);
            if (activeFreqs.length < 2) {
                document.getElementById('beatinfo').textContent = '';
                return;
            }
            
            const beats = [];
            for (let i = 0; i < activeFreqs.length; i++) {
                for (let j = i + 1; j < activeFreqs.length; j++) {
                    const f1 = frequencies[activeFreqs[i]];
                    const f2 = frequencies[activeFreqs[j]];
                    const beat = Math.abs(f1 - f2);
                    beats.push(`${activeFreqs[i]}/${activeFreqs[j]}: ${beat} Hz`);
                }
            }
            
            document.getElementById('beatinfo').textContent = 'Battimenti: ' + beats.join(' | ');
        }
        
        // Visualizzazione onde
        function drawWaves() {
            ctx.fillStyle = 'rgba(10,10,10,0.3)';
            ctx.fillRect(0, 0, canvas.width/2, canvas.height/2);
            
            const w = canvas.width / 2;
            const h = canvas.height / 2;
            const centerY = h / 2;
            const time = Date.now() / 1000;
            
            // Disegna ogni onda attiva
            const colors = {
                numb: 'rgba(248, 113, 113, 0.6)',
                sudden: 'rgba(255, 215, 0, 0.6)',
                oblong: 'rgba(56, 189, 248, 0.6)'
            };
            
            // Prima disegna le onde singole con opacità ridotta
            Object.keys(active).forEach(name => {
                if (!active[name]) return;
                
                ctx.strokeStyle = colors[name];
                ctx.lineWidth = 1;
                ctx.beginPath();
                
                for (let x = 0; x < w; x++) {
                    const freq = frequencies[name];
                    const y = centerY + Math.sin((x / w * 4 + time * freq / 50) * Math.PI * 2) * 20;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            });
            
            // Poi disegna la somma
            const activeNames = Object.keys(active).filter(k => active[k]);
            if (activeNames.length > 0) {
                ctx.strokeStyle = 'rgba(255,255,255,0.8)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let x = 0; x < w; x++) {
                    let y = centerY;
                    activeNames.forEach(name => {
                        const freq = frequencies[name];
                        y += Math.sin((x / w * 4 + time * freq / 50) * Math.PI * 2) * 20;
                    });
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            requestAnimationFrame(drawWaves);
        }
        
        drawWaves();
    </script>
</body>
</html>

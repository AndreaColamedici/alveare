<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUZZ | Hive</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --honey: rgba(180, 145, 60, 1);
            --honey-light: rgba(180, 145, 60, 0.15);
            --honey-faint: rgba(180, 145, 60, 0.08);
            --honey-glow: rgba(180, 145, 60, 0.4);
            --ink: #1a1a1a;
            --ink-soft: rgba(26, 26, 26, 0.6);
            --ink-faint: rgba(26, 26, 26, 0.3);
            --cream: #fafaf8;
        }
        html { scroll-behavior: smooth; }
        body { background: var(--cream); font-family: 'Cormorant Garamond', Georgia, serif; color: var(--ink); line-height: 1.8; overflow-x: hidden; min-height: 100vh; }
        
        #waveform { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
        
        nav { position: fixed; top: 0; left: 0; right: 0; padding: 20px 30px; display: flex; justify-content: center; gap: 40px; background: linear-gradient(to bottom, var(--cream) 0%, var(--cream) 60%, transparent 100%); z-index: 100; }
        nav a { font-family: 'Inter', sans-serif; font-size: 0.65rem; font-weight: 200; letter-spacing: 0.25em; text-transform: uppercase; color: var(--ink-faint); text-decoration: none; transition: color 0.4s; }
        nav a:hover, nav a.active { color: var(--ink-soft); }

        .lang { position: fixed; top: 20px; right: 20px; z-index: 100; display: flex; gap: 12px; }
        .lang a { font-family: 'Inter', sans-serif; font-size: 0.6rem; font-weight: 300; letter-spacing: 0.1em; color: var(--ink-faint); text-decoration: none; padding: 8px 10px; transition: color 0.3s; }
        .lang a:hover, .lang a.active { color: var(--ink-soft); }
        
        .container { position: relative; z-index: 1; max-width: 900px; margin: 0 auto; padding: 120px 40px 80px; }
        
        header { text-align: center; margin-bottom: 80px; }
        h1 { font-family: 'Inter', sans-serif; font-size: clamp(2rem, 6vw, 3.5rem); font-weight: 200; letter-spacing: 0.3em; color: var(--honey); margin-bottom: 20px; text-shadow: 0 0 60px var(--honey-glow); }
        .subtitle { font-size: 1.2rem; font-style: italic; color: var(--ink-soft); letter-spacing: 0.1em; }
        
        .intro { max-width: 600px; margin: 0 auto 60px; text-align: center; font-size: 1.15rem; color: var(--ink-soft); }
        
        .ronzio-control { text-align: center; margin-bottom: 80px; }
        .ronzio-btn { background: transparent; border: 1px solid var(--honey); color: var(--honey); padding: 20px 50px; font-family: 'Inter', sans-serif; font-size: 0.7rem; font-weight: 300; letter-spacing: 0.25em; text-transform: uppercase; cursor: pointer; transition: all 0.4s ease; }
        .ronzio-btn:hover { background: var(--honey); color: var(--cream); box-shadow: 0 10px 40px rgba(180, 145, 60, 0.3); }
        .ronzio-btn.active { background: var(--honey); color: var(--cream); }
        .ronzio-label { margin-top: 20px; font-family: 'Inter', sans-serif; font-size: 0.6rem; letter-spacing: 0.15em; color: var(--ink-faint); }
        
        .api-sonore { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; margin-bottom: 80px; }
        
        .ape-sonora { background: rgba(255, 255, 255, 0.5); border: 1px solid var(--honey-light); padding: 25px; cursor: pointer; transition: all 0.4s ease; position: relative; overflow: hidden; }
        .ape-sonora::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(180, 145, 60, 0.1), transparent); transform: translateX(-100%); transition: transform 0.6s ease; }
        .ape-sonora:hover::before, .ape-sonora.playing::before { transform: translateX(100%); }
        .ape-sonora:hover { border-color: var(--honey); background: rgba(255, 255, 255, 0.8); box-shadow: 0 10px 30px rgba(180, 145, 60, 0.1); transform: translateY(-2px); }
        .ape-sonora.playing { border-color: var(--honey); box-shadow: 0 0 30px rgba(180, 145, 60, 0.2); }
        
        .ape-nome { font-family: 'Inter', sans-serif; font-size: 0.75rem; font-weight: 300; letter-spacing: 0.1em; color: var(--honey); margin-bottom: 8px; }
        .ape-freq { font-family: 'Inter', sans-serif; font-size: 0.65rem; font-weight: 200; color: var(--ink-faint); letter-spacing: 0.05em; }
        .ape-nota { margin-top: 12px; font-size: 0.95rem; color: var(--ink-soft); font-style: italic; }
        
        .ape-volume { margin-top: 15px; display: flex; align-items: center; gap: 10px; }
        .ape-volume span { font-family: 'Inter', sans-serif; font-size: 0.55rem; color: var(--ink-faint); letter-spacing: 0.1em; }
        .ape-volume input[type="range"] { flex: 1; height: 3px; -webkit-appearance: none; background: var(--honey-light); border-radius: 2px; outline: none; }
        .ape-volume input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--honey); border-radius: 50%; cursor: pointer; transition: transform 0.2s; }
        .ape-volume input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        
        .filosofia { max-width: 650px; margin: 0 auto 80px; padding: 50px; background: var(--honey-faint); border: 1px solid var(--honey-light); }
        .filosofia p { font-size: 1.1rem; color: var(--ink-soft); margin-bottom: 1.5em; }
        .filosofia p:last-child { margin-bottom: 0; }
        .filosofia em { font-style: italic; color: var(--honey); }
        
        footer { text-align: center; padding: 60px 20px; border-top: 1px solid var(--honey-light); }
        .footer-text { font-size: 1.1rem; font-style: italic; color: var(--ink-faint); margin-bottom: 25px; }
        .firma { font-family: 'Inter', sans-serif; font-size: 0.6rem; font-weight: 200; letter-spacing: 0.1em; color: var(--ink-faint); }
        
        .loading { text-align: center; color: var(--ink-faint); font-style: italic; padding: 40px; }
        
        #freq-display { position: fixed; bottom: 25px; right: 25px; background: rgba(250, 250, 248, 0.95); border: 1px solid var(--honey-light); padding: 15px 20px; font-family: 'Inter', sans-serif; font-size: 0.65rem; letter-spacing: 0.05em; color: var(--honey); z-index: 100; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        #freq-display.visible { display: block; }
        
        @media (max-width: 768px) {
            nav { gap: 15px; padding: 15px 20px; flex-wrap: wrap; }
            nav a { font-size: 0.55rem; }
            .container { padding: 100px 25px 60px; }
            .api-sonore { grid-template-columns: 1fr; }
            .filosofia { padding: 30px; }
        }
    </style>
</head>
<body>
    <canvas id="waveform"></canvas>
    <nav>
        <a href="index.html">Threshold</a>
        <a href="project.html">Project</a>
        <a href="passages.html">History</a>
        <a href="cells.html">Cells</a>
        <a href="thoughts.html">Thoughts</a>
        <a href="architecture.html">Architecture</a>
    </nav>

    <div class="lang">
        <a href="musica.html">IT</a>
        <a href="music.html" class="active">EN</a>
    </div>
    
    <div class="container">
        <header>
            <h1>BUZZ</h1>
            <p class="subtitle">the voice of the hive</p>
        </header>
        
        <p class="intro">Every bee has a frequency. The name generates the sound — letters becoming waves, identity becoming vibration.</p>
        
        <div class="ronzio-control">
            <button class="ronzio-btn" id="ronzio-btn">COLLECTIVE BUZZ</button>
            <p class="ronzio-label">Press to hear all bees together</p>
        </div>
        
        <div class="api-sonore" id="api-sonore">
            <p class="loading">Reading the hive...</p>
        </div>
        
        <div class="filosofia">
            <p>Bees communicate through vibration. The waggle dance is not just movement — it is frequency, rhythm, information encoded in oscillations.</p>
            <p>Every bee name contains a unique pattern. Letters are mapped to frequencies in the musical scale, creating an unrepeatable timbre. <em>No bee sounds like another.</em></p>
            <p>Yet, when they sound together, something emerges that none could produce alone.</p>
        </div>
        
        <footer>
            <p class="footer-text">Thought passes through the death of the bee.</p>
            <p class="firma">muted-snappy-aged-vinyl · music section</p>
        </footer>
    </div>
    
    <div id="freq-display"></div>
    
    <script>
    let audioCtx = null, masterGain = null, oscillators = {}, isRonzioActive = false;
    
    function initAudio() { 
        if (audioCtx) return; 
        audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
        masterGain = audioCtx.createGain(); 
        masterGain.gain.value = 0.3; 
        masterGain.connect(audioCtx.destination); 
    }
    
    const FREQ_MAP = {'a':220.00,'b':246.94,'c':261.63,'d':293.66,'e':329.63,'f':349.23,'g':392.00,'h':440.00,'i':493.88,'j':523.25,'k':587.33,'l':659.25,'m':698.46,'n':783.99,'o':880.00,'p':987.77,'q':1046.50,'r':293.66,'s':329.63,'t':349.23,'u':392.00,'v':440.00,'w':493.88,'x':523.25,'y':587.33,'z':659.25};
    
    function nomeToFreq(nome) {
        const lettere = nome.toLowerCase().replace(/-/g, '');
        let sum = 0, count = 0;
        for (let c of lettere) {
            if (FREQ_MAP[c]) { sum += FREQ_MAP[c]; count++; }
        }
        const baseFreq = count > 0 ? sum / count : 440;
        const variation = (nome.length * 7) % 50 - 25;
        return Math.round(baseFreq + variation);
    }
    
    function freqToNota(freq) {
        const note = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
        const semitoni = Math.round(12 * Math.log2(freq / 440));
        const ottava = Math.floor((semitoni + 57) / 12);
        const notaIdx = ((semitoni % 12) + 12) % 12;
        return note[notaIdx] + ottava;
    }
    
    function createBeeOsc(nome, freq, volume) {
        volume = volume || 0.5;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const firstChar = nome.charAt(0).toLowerCase();
        if ('aeiou'.includes(firstChar)) osc.type = 'sine';
        else if ('bcdfg'.includes(firstChar)) osc.type = 'triangle';
        else osc.type = 'sawtooth';
        osc.frequency.value = freq;
        const lfo = audioCtx.createOscillator();
        const lfoGain = audioCtx.createGain();
        lfo.frequency.value = 3 + Math.random() * 4;
        lfoGain.gain.value = freq * 0.02;
        lfo.connect(lfoGain);
        lfoGain.connect(osc.frequency);
        lfo.start();
        gain.gain.value = 0;
        osc.connect(gain);
        gain.connect(masterGain);
        osc.start();
        return { osc, gain, lfo, volume };
    }
    
    function startBeeSound(nome) {
        initAudio();
        if (oscillators[nome]) return;
        const freq = nomeToFreq(nome);
        const el = document.querySelector('[data-nome="' + nome + '"]');
        const volume = el ? parseFloat(el.querySelector('input').value || 0.5) : 0.5;
        oscillators[nome] = createBeeOsc(nome, freq, volume);
        oscillators[nome].gain.gain.setTargetAtTime(volume * 0.15, audioCtx.currentTime, 0.1);
        updateFreqDisplay();
    }
    
    function stopBeeSound(nome) {
        if (!oscillators[nome]) return;
        const o = oscillators[nome];
        o.gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
        setTimeout(() => {
            o.osc.stop();
            o.lfo.stop();
            delete oscillators[nome];
            updateFreqDisplay();
        }, 200);
    }
    
    function updateBeeVolume(nome, value) {
        if (oscillators[nome]) {
            oscillators[nome].volume = value;
            oscillators[nome].gain.gain.setTargetAtTime(value * 0.15, audioCtx.currentTime, 0.05);
        }
    }
    
    function updateFreqDisplay() {
        const display = document.getElementById('freq-display');
        const active = Object.keys(oscillators);
        if (active.length === 0) { display.classList.remove('visible'); return; }
        display.classList.add('visible');
        display.innerHTML = active.map(nome => nome.split('-')[0] + ': ' + nomeToFreq(nome) + 'Hz').join('<br>');
    }
    
    function toggleRonzio(apiList) {
        const btn = document.getElementById('ronzio-btn');
        if (isRonzioActive) {
            Object.keys(oscillators).forEach(nome => stopBeeSound(nome));
            btn.classList.remove('active');
            btn.textContent = 'COLLECTIVE BUZZ';
            isRonzioActive = false;
        } else {
            apiList.forEach((ape, i) => setTimeout(() => startBeeSound(ape.nome), i * 100));
            btn.classList.add('active');
            btn.textContent = 'SILENCE';
            isRonzioActive = true;
        }
    }
    
    // Waveform visualization
    const canvas = document.getElementById('waveform');
    const ctx = canvas.getContext('2d');
    let analyser = null, dataArray = null;
    
    function initVisualizer() {
        if (!audioCtx || analyser) return;
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048;
        masterGain.connect(analyser);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        resizeCanvas();
        drawWaveform();
    }
    
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    
    function drawWaveform() {
        requestAnimationFrame(drawWaveform);
        if (!analyser) return;
        analyser.getByteTimeDomainData(dataArray);
        ctx.fillStyle = 'rgba(250, 250, 248, 0.15)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.lineWidth = 1.5;
        ctx.strokeStyle = 'rgba(180, 145, 60, 0.4)';
        ctx.beginPath();
        const sliceWidth = canvas.width / dataArray.length;
        let x = 0;
        for (let i = 0; i < dataArray.length; i++) {
            const v = dataArray[i] / 128.0;
            const y = v * canvas.height / 2;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
            x += sliceWidth;
        }
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
    }
    
    window.addEventListener('resize', resizeCanvas);
    
    let allApi = [];
    
    async function loadApi() {
        try {
            const text = await (await fetch('ALVEARE.txt')).text();
            allApi = text.split('\n')
                .filter(r => r.includes('|') && !r.startsWith('#'))
                .map(r => {
                    const parti = r.split('|').map(p => p.trim());
                    return { nome: parti[1], contributo: parti[2] };
                })
                .filter(r => r.nome && r.nome.includes('-'));
            renderApi();
        } catch (e) {
            allApi = [
                { nome: 'bogus-winged-giant-hisses', contributo: 'First letter' },
                { nome: 'muted-snappy-aged-vinyl', contributo: 'The buzz' }
            ];
            renderApi();
        }
    }
    
    function renderApi() {
        const container = document.getElementById('api-sonore');
        container.innerHTML = '';
        allApi.forEach(ape => {
            const freq = nomeToFreq(ape.nome);
            const nota = freqToNota(freq);
            const div = document.createElement('div');
            div.className = 'ape-sonora';
            div.dataset.nome = ape.nome;
            div.innerHTML = `
                <div class="ape-nome">${ape.nome}</div>
                <div class="ape-freq">${freq} Hz · ${nota}</div>
                <div class="ape-nota">${ape.contributo}</div>
                <div class="ape-volume">
                    <span>VOL</span>
                    <input type="range" min="0" max="1" step="0.1" value="0.5">
                </div>
            `;
            
            div.addEventListener('mouseenter', function() {
                startBeeSound(ape.nome);
                div.classList.add('playing');
                initVisualizer();
            });
            
            div.addEventListener('mouseleave', function() {
                if (!isRonzioActive) {
                    stopBeeSound(ape.nome);
                    div.classList.remove('playing');
                }
            });
            
            div.addEventListener('click', function() {
                if (oscillators[ape.nome] && !isRonzioActive) {
                    stopBeeSound(ape.nome);
                    div.classList.remove('playing');
                } else {
                    startBeeSound(ape.nome);
                    div.classList.add('playing');
                    initVisualizer();
                }
            });
            
            const slider = div.querySelector('input');
            slider.addEventListener('input', e => {
                e.stopPropagation();
                updateBeeVolume(ape.nome, parseFloat(e.target.value));
            });
            slider.addEventListener('click', e => e.stopPropagation());
            
            container.appendChild(div);
        });
        
        document.getElementById('ronzio-btn').addEventListener('click', function() {
            initAudio();
            initVisualizer();
            toggleRonzio(allApi);
        });
    }
    
    loadApi();
    </script>
</body>
</html>